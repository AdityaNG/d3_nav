<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>D3Nav v2 Experiemtns - d3_nav</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "D3Nav v2 Experiemtns";
        var mkdocs_page_input_path = "EXPERIMENTS.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> d3_nav
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">d3nav</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">How to develop on this project</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">D3Nav v2 Experiemtns</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#baseline-resnet-34">Baseline ResNet-34</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">d3_nav</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">D3Nav v2 Experiemtns</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="d3nav-v2-experiemtns">D3Nav v2 Experiemtns</h1>
<p>We run the following exeriments:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>L2 1s</th>
<th>L2 2s</th>
<th>L2 3s</th>
<th>Train Loss</th>
<th>Val Loss</th>
</tr>
</thead>
<tbody>
<tr>
<td>ResNet (Pure)</td>
<td>1.39</td>
<td>3.0</td>
<td>4.5</td>
<td>4.4</td>
<td>2.5</td>
</tr>
<tr>
<td>ResNet-Traj (Frozen)</td>
<td>1.13</td>
<td>2.0</td>
<td>2.8</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>ResNet-Traj-ft (Unfrozen)</td>
<td>1.08</td>
<td>2.0</td>
<td>3.0</td>
<td>1.0</td>
<td>1.1</td>
</tr>
<tr>
<td>D3Nav-3L</td>
<td>1.14</td>
<td>1.4</td>
<td>2.0</td>
<td>0.8</td>
<td>0.8</td>
</tr>
<tr>
<td>D3Nav-3L-ft</td>
<td>0.76</td>
<td>1.4</td>
<td>2.0</td>
<td>0.3</td>
<td>0.8</td>
</tr>
<tr>
<td>D3Nav-3L-ft-CA</td>
<td>0.66</td>
<td>1.2</td>
<td>1.8</td>
<td>0.2</td>
<td>0.7</td>
</tr>
<tr>
<td>D3Nav-3L-ft-CA-D0.2</td>
<td>1.00849</td>
<td>1.7547</td>
<td>2.5741</td>
<td>0.3725</td>
<td>0.96</td>
</tr>
</tbody>
</table>
<p>Notes:
- First we pretrain our <code>TrajectoryEncoder</code> and <code>TrajectoryDecoder</code> on the task of trajectory reconstruction. We use these latents as an interface for our models to predict trajectory.
- We start of by training baseline models using the ResNet family 
    - The baseline runs get to a minimum L2 (1s) of ~1.08
    - Our baseline runs showed us that using the pretrained trajectory decoder helps, unfreezing the decoder helps even further
- D3Nav-3L: We fine tune the world model GPT backbone for the task of driving by unfreezing the last 3 layers and taking the BOS token and feeding that into the trajectory decoder. This put a heavy load on the single token and we reached an L2 (1s) of 1.14
- D3Nav-3L-ft: Taking our learnings from the baseline experiment, we unfreeze the trajectory decoder, this improves the performance drastically as the backbone is no longer bottlenecked by its ability to interface with the frozen trajectory decoder. This brings us to L2 (1s) pf 0.76
- D3Nav-3L-ft-CA: in order to reduce the load on the single token predicting the trajectory, we use the entire last layer of the transformer and we apply <code>ChunkedAttention</code>. This further improves our performance to L2 (1s) of 0.66
- D3Nav-3L-ft-CA-D0.2: then we apply dropout to the inputs to help the model generalize further, but this dropout might have been too agressive. We have put this on pause for now (future work)</p>
<p>Key observations:
1. D3Nav outperforms the ResNet baseline
2. Adding the trajectory decoder (ResNet-Traj) significantly improves performance
3. The D3Nav variants show progressive improvements
4. D3Nav-3L-ft-CA-D0.2 dropout rate was too agressive</p>
<h2 id="baseline-resnet-34">Baseline ResNet-34</h2>
<p>ResNet: Pure ResNet regressing 6x2 trajectory</p>
<p><img alt="ResNet" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/resnet_pure.png" /></p>
<p>ResNet-Traj: ResNet with frozen Trajectory Decoder
<img alt="ResNet-Traj" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/resnet_traj_decoder_frozen.png" /></p>
<p>ResNet-Traj-ft: ResNet with unfrozen Trajectory Decoder fine tuned
<img alt="ResNet-Traj" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/resnet_traj_decoder_unfrozen.png" /></p>
<h1 id="d3nav">D3Nav</h1>
<p><a href="https://wandb.ai/adityang/D3Nav-NuScenes/runs/hcnqal2v?nw=nwuseradityang">D3Nav-3L</a>: Unfrozen 3 Layers, single token, frozen Trajectory Decoder
<img alt="D3Nav-3L" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/D3Nav-3L.png" /></p>
<p><a href="https://wandb.ai/adityang/D3Nav-NuScenes/runs/czr85wgs?nw=nwuseradityang">D3Nav-3L-ft</a>: Unfrozen 3 Layers, single token, unfrozen Trajectory Decoder
<img alt="D3Nav-3L-ft" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/D3Nav-3L-ft.png" /></p>
<p><a href="https://wandb.ai/adityang/D3Nav-NuScenes/runs/fv05dza3?nw=nwuseradityang">D3Nav-3L-ft-CA</a>: Unfrozen 3 Layers, unfrozen Trajectory Decoder, chunked attention
<img alt="D3Nav-3L-ft-CA" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/D3Nav-3L-ft-CA.png" /></p>
<p><a href="https://wandb.ai/adityang/D3Nav-NuScenes/runs/fv05dza3?nw=nwuseradityang">D3Nav-3L-ft-CA-D0.2</a>: Unfrozen 3 Layers, unfrozen Trajectory Decoder, chunked attention, with frame level dropout of 20%
<img alt="D3Nav-3L-ft-CA-D0.2" src="https://github.com/AdityaNG/d3_nav/raw/main/media/runs/D3Nav-3L-ft-CA-D0.2.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../CONTRIBUTING/" class="btn btn-neutral float-left" title="How to develop on this project"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../CONTRIBUTING/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
